<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sainsbury's Barcode Generator</title>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #f57c2c;
    }
    .watermark {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        display: grid;
        grid-template-columns: repeat(auto-fill, 400px);
        grid-template-rows: repeat(auto-fill, 120px); /* fixed spacing */
        transform: rotate(-30deg);
        z-index: 0;
    }
    .watermark span {
        font-size: 28px;
        font-weight: bold;
        color: rgba(255, 255, 255, 0.4);
        white-space: nowrap;
    }
    .container {
        background: white;
        padding: 20px;
        border-radius: 10px;
        max-width: 500px;
        margin: 50px auto;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        text-align: center;
        position: relative;
        z-index: 1;
    }
    input, button {
        width: 100%;
        padding: 10px;
        margin: 5px 0;
    }
    #discord-btn {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #5865F2;
        border: none;
        border-radius: 50%;
        padding: 12px;
        cursor: pointer;
        z-index: 1000;
    }
    #discord-btn svg {
        width: 28px;
        height: 28px;
        fill: white;
    }
</style>
</head>
<body>

<!-- Watermarks -->
<div class="watermark" id="watermark"></div>

<!-- Main container -->
<div class="container">
    <h1>Sainsbury's Barcode Generator</h1>
    <input type="text" id="barcode" placeholder="Enter original product barcode">
    <input type="number" id="price" placeholder="Enter price (e.g., 100 = Â£1.00)">
    <button onclick="generateBarcode()">Generate Barcode</button>
    <p style="color:red;font-weight:bold;">most 30p barcodes are patched</p>
    <canvas id="barcodeCanvas" width="600" height="200"></canvas>
    <button id="downloadBtn">Download as PNG</button>
</div>

<!-- Floating Discord Button -->
<button id="discord-btn" onclick="window.open('https://discord.gg/thesellhub','_blank')">
    <svg viewBox="0 0 245 240">
        <path d="M104.4 104.5c-5.7 0-10.2 5-10.2 11.1 0 6.1 4.6 11.1 10.2 11.1 5.7 0 10.2-5 10.2-11.1-.1-6.1-4.6-11.1-10.2-11.1zm36.2 0c-5.7 0-10.2 5-10.2 11.1 0 6.1 4.6 11.1 10.2 11.1 5.7 0 10.2-5 10.2-11.1 0-6.1-4.5-11.1-10.2-11.1z"/>
        <path d="M189.5 20h-134C24.5 20 0 44.5 0 75.5v89c0 31 24.5 55.5 55.5 55.5h110l-5.2-18.1 12.5 11.6 11.8 10.8 20.9 18.8V75.5C205.5 44.5 181 20 150 20z"/>
    </svg>
</button>

<script src="barcodes.js"></script>
<script>
/* Generate watermark grid */
(function(){
    const wmDiv = document.getElementById('watermark');
    const rows = 10, cols = 10;
    for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
            const span = document.createElement('span');
            span.innerText = '.gg/thesellhub';
            wmDiv.appendChild(span);
        }
    }
})();

/* Key system */
const ACCESS_KEY = ".gg/thesellhub";
let userKey = prompt("Enter access key:");
if (userKey !== ACCESS_KEY) {
    alert("Invalid key.");
    window.location.href = "about:blank";
}

/* Idle redirect logic */
let idleTimer = null;
const IDLE_REDIRECT_MS = 7000;
const IDLE_REDIRECT_URL = "https://guns.lol/rised";

function startIdleTimer() {
    clearIdleTimer();
    idleTimer = setTimeout(() => {
        window.location.href = IDLE_REDIRECT_URL;
    }, IDLE_REDIRECT_MS);
    const cancelEvents = ['mousemove','keydown','mousedown','touchstart','scroll','click'];
    cancelEvents.forEach(evt => {
        document.addEventListener(evt, cancelIdleTimer, { once: true, passive: true });
    });
}
function cancelIdleTimer() {
    clearIdleTimer();
}
function clearIdleTimer() {
    if (idleTimer !== null) {
        clearTimeout(idleTimer);
        idleTimer = null;
    }
}

/* Barcode generation */
function generateBarcode() {
    let code = document.getElementById("barcode").value;
    let price = document.getElementById("price").value;
    if (!code || !price) return alert("Enter both barcode and price.");
    JsBarcode("#barcodeCanvas", code + price, {
        format: "CODE128",
        displayValue: true,
        fontSize: 18,
        width: 2,
        height: 100,
        margin: 10
    });
}

/* Download + idle trigger */
document.getElementById('downloadBtn').addEventListener('click', () => {
    const canvas = document.getElementById("barcodeCanvas");
    const a = document.createElement('a');
    a.href = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
    a.download = "barcode.png";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    startIdleTimer();
});
</script>
</body>
</html>
